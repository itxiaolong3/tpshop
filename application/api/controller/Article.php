<?php/** * Created by PhpStorm. * User: Administrator * Date: 2018/12/26 * Time: 20:02 */namespace app\api\controller;use think\Db;use think\Page;class Article extends Base{    /**     * 轮播图列表     */    public function bannerlist(){        $list=Db::name('banner')->where('is_show',1)->select();        foreach ($list as $k => $v){            $list[$k]['b_img'] = url_add_domain($v['b_img']);        }        return returnOk($list);    }    /**     * 文章内列表页     */    public function articleList(){        $article_cat = M('ArticleCat')->field("cat_id,cat_name")->select();        $article = M('Article');        $cat_id = I('cat_id/d',0);        if(!$cat_id){            $cat_id = get_arr_column($article_cat,"cat_id");        }        $count = $article->where(['cat_id'=>["in", $cat_id]])->count();        $Page = new Page($count, 10);        $article_list = $article->where(['cat_id'=>["in", $cat_id]])->field("article_id,title,content,publish_time,description,thumb")            ->limit($Page->firstRow . ',' . $Page->listRows)->select();        foreach ($article_list as $k => $v){            $article_list[$k]['thumb'] = url_add_domain($v['thumb']);        }        $data = [            'article_cat' => $article_cat,            'article_list' => $article_list        ];        return returnOk($data);    }    /**     * 文章内容页     */    public function detail(){        $article_id = I('article_id/d',1);        $article = Db::name('article')->where("article_id", $article_id)->find();        if($article){            $parent = Db::name('article_cat')->where("cat_id",$article['cat_id'])->find();            $this->assign('cat_name',$parent['cat_name']);            $this->assign('article',$article);        }        return $this->fetch();    }    //接口获取帮助中心文章    public function articleListforHelp(){        $article = Db::name('Article');        $article_cat =Db::name('article_cat');        $cat_id = I('cat_id/d',0);        if(!$cat_id){            //帮助中心分类对应的ID            $getcar_id=$article_cat->where('cat_name','帮助中心')->find();            $cat_id=$getcar_id['cat_id'];        }        $count = $article->where(['cat_id'=>["in", $cat_id]])->count();        $Page = new Page($count, 10);        $article_list = $article->where(['cat_id'=>["in", $cat_id]])->field("article_id,title,thumb")            ->limit($Page->firstRow . ',' . $Page->listRows)->select();        $data = [            'article_list' => $article_list        ];        return returnOk($data);    }    //接口具体文章    public function articleDetailforHelp(){        $article = Db::name('Article');        $article_id = I('article_id/d',0);        $getcontent=$article->where('article_id',$article_id)->find();        $data = [            'article_list' => $getcontent        ];        return returnOk($data);    }    //接口获取今天头条文章    public function articleListforTT(){        $article = Db::name('Article');        $article_cat =Db::name('article_cat');        $cat_id = I('cat_id/d',0);        if(!$cat_id){            //帮助中心分类对应的ID            $getcar_id=$article_cat->where('cat_name','今日头条')->find();            $cat_id=$getcar_id['cat_id'];        }        $count = $article->where(['cat_id'=>["in", $cat_id]])->count();        $Page = new Page($count, 10);        $article_list = $article->where(['cat_id'=>["in", $cat_id]])->field("article_id,title,thumb,add_time,content")            ->limit($Page->firstRow . ',' . $Page->listRows)->select();        foreach ($article_list as $k=>$v){            $article_list[$k]['add_time']=date('Y-m-d H:i:s',$v['add_time']);            $article_list[$k]['content']=htmlspecialchars_decode($v['content']);        }        $data = [            'article_list' => $article_list        ];        return returnOk($data);    }    //接口具体文章    public function articleDetailforTT(){        $article = Db::name('Article');        $article_id = I('article_id/d',0);        $getcontent=$article->where('article_id',$article_id)->find();        $getcontent['add_time']=date('Y-m-d H:i:s',$getcontent['add_time']);        $getcontent['content']=htmlspecialchars_decode($getcontent['content']);        $data = [            'article_list' => $getcontent        ];        return returnOk($data);    }    //获取所有题目    public function questionsList(){        $questions_attribute = Db::name('questions_attribute');        $questions =Db::name('questions_type');        $cat_id = I('cat_id/d',0);        $count = $questions->count();        $Page = new Page($count, 20);        $article_list = $questions->field("id,name")            ->limit($Page->firstRow . ',' . $Page->listRows)->select();        foreach ($article_list as $k=>$v){            $anlist=$questions_attribute->where('q_id',$v['id'])->select();            $article_list[$k]['questions']=$anlist;            $truearr=[];            foreach ($anlist as $kk=>$vv){                if ($vv['is_answer']){                    array_push($truearr,$vv['attr_id']);                }            }            $article_list[$k]['tureresult']=$truearr;        }        $data = [            'questionslist' => $article_list        ];        return returnOk($data);    }}